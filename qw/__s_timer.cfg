////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                //
//                                    TIMER FOR RL / QUAD                                         //
//                                                                                                //
////////////////////////////////////////////////////////////////////////////////////////////////////

//BUGS

//TODO
// lg
// low/high-rl
// items based on map

// RESET
////////////////////////////////////////////////////////////////////////////////////////////////////
unalias_re ^stp\_timer\_$
unalias_re ^\_\.t\.(.+)$
unset_re ^\_\.t\.(.+)


// _.t. Vars
////////////////////////////////////////////////////////////////////////////////////////////////////
set ___.t.debug 0

set _.t.n "rl"
set _.t.name.rl $tp_name_rl
set _.t.name.quad $tp_name_quad

set _.t.int.rl 57
set _.t.int.rl.val 30
set _.t.int.quad 55
set _.t.int.quad.val 60

set _.t.int.i1 0
set _.t.int.i2 0
set _.t.int.i3 0
set _.t.int.i1.val 30
set _.t.int.i2.val 30
set _.t.int.i3.val 60

set _.t.int.u1 0
set _.t.int.u2 0
set _.t.int.d1 0
set _.t.int.d2 0
set _.t.int.early 0
set _.t.int.late 0
set _.t.int.kp 0

set _.t.str.kp1 ""
set _.t.str.kp2 ""
set_tp _.t.str.u1 ""
set_tp _.t.str.u2 ""
set_tp _.t.str.d1 ""
set_tp _.t.str.d2 ""
set_tp _.t.str.elate ""
set_tp _.t.str.eol ""
set_tp tp_name_late "late"
set_tp tp_name_early "early"
set_tp tp_name_ontime "on$x20time"


// _.t. Map specific vars
////////////////////////////////////////////////////////////////////////////////////////////////////
alias _.t.map.items "if ('$mapname' == 'dm3') then _.t.map.dm3 else if ('$mapname' == 'dm2) then _.t.map.dm2 else if ('$mapname' == 'e1m2') then _.t.map.e1m2 else _.t.map.any"
alias _.t.map.


// _.t. Time
////////////////////////////////////////////////////////////////////////////////////////////////////
alias _.t.clamp          "if ($%1 >= 60) then set %1 0 else if ($%1 < 0) then set %1 59"
alias _.t.stoi           "set_calc %2 %1 * 1"
alias _.t.itos           "if (%1 < 10) then set %2 0%1 else set %2 %1"
alias _.t.itostp         "if (%1 < 10) then set %2 0%1 else set %2 %1"
alias _.t.debug          "echo up time: $_.t.int.%1 | kp1:$_.t.str.kp1 kp2:$_.t.str.kp2 | u:$_.t.int.u1/$_.t.int.u2 d:$_.t.int.d1/$_.t.int.d2 | e:$_.t.int.early l:$_.t.int.late"
alias _.t.debugn         "if ($___.t.debug > 0) then _.t.debug $_.t.n"

alias _.t.item           "set _.t.n %1; _.t.getn tmp; _.t.setn $tmp; _.t.kp.norm $tmp tmp; _.t.kp.set $tmp"
alias _.t.set            "set tmp %2; _.t.clamp tmp; set _.t.int.%1 $tmp; _.t.calcn; wait; "
alias _.t.setn           "_.t.set $_.t.n %1"
alias _.t.get            "set %2 $_.t.int.%1"
alias _.t.getn           "_.t.get $_.t.n %1"
alias _.t.calc           "_.t.calc.up %1; _.t.calc.down %1; wait; _.t.calc.elate"
alias _.t.calcn          "_.t.calc $_.t.n"
alias _.t.calc.up        "set tmpcalc $_.t.int.%1; set_calc _.t.int.u1 $tmpcalc % $_.t.int.%1.val; set_calc _.t.int.u2 $_.t.int.u1 + $_.t.int.%1.val"
alias _.t.calc.down      "set_calc tmpcalc 60 - $_.t.int.%1; set_calc _.t.int.d2 $tmpcalc % $_.t.int.%1.val; set_calc _.t.int.d1 $_.t.int.d2 + $_.t.int.%1.val"
alias _.t.calc.elate     "set _.t.int.early $_.t.int.d2; set _.t.int.late $_.t.int.u1"

alias _.t.create.str     "_.t.create.str.eol; _.t.itostp $_.t.int.u1 _.t.str.u1; _.t.itostp $_.t.int.u2 _.t.str.u2; _.t.itostp $_.t.int.d1 _.t.str.d1; _.t.itostp $_.t.int.d2 _.t.str.d2; _.t.itostp $_.t.int.early _.t.str.early; _.t.itostp $_.t.int.late _.t.str.late"
alias _.t.create.str.eol "set_tp _.t.str.eol $qt$qt; set _.t.str.elate $qt$qt; if ($_.t.int.early == 0 AND $_.t.int.late == 0) then set_tp _.t.str.eol $tp_name_ontime else if ($_.t.int.early < $_.t.int.late) then set_tp _.t.str.eol $tp_name_early else set_tp _.t.str.eol $tp_name_late; if ($_.t.int.early < $_.t.int.late) then set _.t.str.elate $_.t.int.early else if ($_.t.int.late < $_.t.int.early) then set _.t.str.elate $_.t.int.late"

alias _.t.say            "_.t.kp.final; _.t.create.str; wait; .tsay.timer.%1 %1"
alias _.t.sayn           "_.t.say $_.t.n"


// _.t. Keypad
////////////////////////////////////////////////////////////////////////////////////////////////////
alias _.t.kp.norm   "if ($hud_gameclock_countdown > 0) then set_calc %2 60 - %1"
alias _.t.kp.set    "set_calc tmp2 %1 % 10; set_calc tmp1 %1 - $tmp2; set_calc tmp1 $tmp1 / 10; set _.t.str.kp1 $tmp1; set _.t.str.kp2 $tmp2; _.t.kp.setint; _.t.kp.bind1"
alias _.t.kp.set1   "set _.t.str.kp1 %1; set _.t.str.kp2 ?; _.t.kp.bind2; _.t.kp.setint; wait; _.t.kp.echon"
alias _.t.kp.set2   "set _.t.str.kp2 %1; _.t.kp.bind1; _.t.kp.enter"
alias _.t.kp.setb   "set _.t.str.kp1 %1; set _.t.str.kp2 %2; _.t.kp.bind1; _.t.kp.enter"
alias _.t.kp.bind1  "bind kp_0 _.t.kp.set1 0; bind kp_1 _.t.kp.set1 1; bind kp_2 _.t.kp.set1 2; bind kp_3 _.t.kp.set1 3; bind kp_4 _.t.kp.set1 4; bind kp_5 _.t.kp.set1 5; bind kp_6 _.t.kp.setb 0 6; bind kp_7 _.t.kp.setb 0 7; bind kp_8 _.t.kp.setb 0 8; bind kp_9 _.t.kp.setb 0 9"
alias _.t.kp.bind2  "bind kp_0 _.t.kp.set2 0; bind kp_1 _.t.kp.set2 1; bind kp_2 _.t.kp.set2 2; bind kp_3 _.t.kp.set2 3; bind kp_4 _.t.kp.set2 4; bind kp_5 _.t.kp.set2 5; bind kp_6 _.t.kp.set2 6; bind kp_7 _.t.kp.set2 7; bind kp_8 _.t.kp.set2 8; bind kp_9 _.t.kp.set2 9"
alias _.t.kp.setint "_.t.stoi $_.t.str.kp1$_.t.str.kp2 _.t.int.kp"
alias _.t.kp.inc    "_.t.kp.setint; inc _.t.int.kp 1; _.t.clamp _.t.int.kp; wait; _.t.kp.set $_.t.int.kp; _.t.kp.norm $_.t.int.kp tmp; _.t.setn $tmp; _.t.kp.echon"
alias _.t.kp.dec    "_.t.kp.setint; inc _.t.int.kp -1; _.t.clamp _.t.int.kp; wait; _.t.kp.set $_.t.int.kp; _.t.kp.norm $_.t.int.kp tmp; _.t.setn $tmp; _.t.kp.echon"
alias _.t.kp.final  "_.t.kp.setint; _.t.kp.set $_.t.int.kp; _.t.kp.norm $_.t.int.kp tmp; _.t.setn $tmp"
alias _.t.kp.enter  "_.t.kp.final; _.t.kp.echon; _.t.debugn"
alias _.t.kp.late   "_.t.kp.setint; _.t.setn $_.t.int.kp; _.t.kp.norm $_.t.int.kp tmp; _.t.kp.set $tmp; _.t.kp.echon; _.t.debugn"
alias _.t.kp.early  "_.t.kp.setint; set_calc tmp 60 - $_.t.int.kp; _.t.setn $tmp; if ($hud_gameclock_countdown > 0) then _.t.kp.set $_.t.int.kp else _.t.kp.set $tmp; _.t.kp.echon; _.t.debugn" 

alias _.t.kp.echo   "echo $_.t.name.%1 $_.t.str.kp1$_.t.str.kp2"
alias _.t.kp.echon  "_.t.kp.echo $_.t.n"


// .tsay. Teamsays
////////////////////////////////////////////////////////////////////////////////////////////////////
alias .tsay.timer.rl    "say_team $\  $_.t.name.%1 {&cfffis&r} $_.t.str.elate {&cfff$_.t.str.eol&r} {&c9f9:$_.t.str.u1/$_.t.str.u2&r} {&cfffor&r} {&cf99:$_.t.str.d1/$_.t.str.d2&r}"
alias .tsay.timer.quad  "say_team $\  $_.t.name.%1 {&cfffis on&r} {&c9f9:$_.t.int.u1&r} {&cfffor&r} {&cf99:$_.t.int.d2&r}"


// init1 - Initialize the defaults
////////////////////////////////////////////////////////////////////////////////////////////////////
_.t.kp.bind1
_.t.item rl

// stp_timer aliases
////////////////////////////////////////////////////////////////////////////////////////////////////
alias stp_timer_item    "_.t.item %1"   // Activate %1 item, example bind x stp_timer_item rl
alias stp_timer_enter   "_.t.kp.enter"  // Finalize keypad entry and echo
alias stp_timer_inc     "_.t.kp.inc"    // Increase keypad entry by 1
alias stp_timer_dec     "_.t.kp.dec"    // Decrease keypad entry by 1
alias stp_timer_early   "_.t.kp.late"   // Finalize keypad and set item to x early
alias stp_timer_late    "_.t.kp.late"   // Finalize keypad and set item to x late
alias stp_timer_say     "_.t.sayn"      // say_team item time


// bind examples
////////////////////////////////////////////////////////////////////////////////////////////////////
bind mouse4     "stp_timer_item rl"
bind mouse5     "stp_timer_item quad"
bind kp_enter   "stp_timer_enter"
bind mwheelup   "stp_timer_inc"
bind mwheeldown "stp_timer_dec"
bind kp_plus    "stp_timer_early"
bind kp_minus   "stp_timer_late"
bind f          "stp_timer_say"
