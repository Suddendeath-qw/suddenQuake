//TODO
// Cleanup setting of variables time, should always set all, reduce the amount?
// Do all calculations using time up? and then just convert between countdown?
// Only echo when action is taken (not bound to set?)
// Include trailing 0 in all prints


// tp_ Timer
////////////////////////////////////////////////////////////////////////////////////////////////////
set _.t.time.u1 0
set _.t.time.u2 0
set _.t.time.d1 0
set _.t.time.d2 0
set _.t.late 0
set _.t.early 0

set_tp _.str.earlate ""
set_tp _.str.time1 ""
set_tp _.str.time2 ""

alias _.t.clamp "if ($%1 >= 60) then set %1 0 else if ($%1 < 0) then set %1 59"

set_tp tp_name_late "late"
set_tp tp_name_early "early"
set_tp tp_name_ontime "on$x20time"

set _.t.quad 55 // quad
set _.t.quad.time 60
set _.t.rl 55 // rl
set _.t.rl.time 30
set _.t.n "rl"

alias _.t.stoi "if ($%1 =~ '^([0]{0,1})([0-9]{1,2})$') then set %2 $re_trigger_match_2 else set %2 $%1"
alias _.t.itos "if (%1 < 10) then set %2 0%1 else set %2 %1"

alias _.t.activate "set _.t.n %1; _.t.kp.set $_.t.%1"
alias _.t.set "set tmp %2; _.t.clamp tmp; set _.t.%1 $tmp; _.t.time.calc $_.t.%1; _.t.echo %1"
alias _.t.setn "_.t.set $_.t.n %1"
alias _.t.set.from.kp "set_calc tmp $_.t.kp1 * 10; set_calc tmp $tmp + $_.t.kp2; _.t.setn $tmp"
alias _.t.reset "set _.t.%1 0; _.t.time.calc $_.t.%1"
alias _.t.up "inc _.t.%1 1; _.t.set %1 $_.t.%1"
alias _.t.down "inc _.t.%1 -1; _.t.set %1 $_.t.%1"

alias _.t.time.calc "_.t.time.up %1; _.t.time.down %1; _.t.time.elate $_.t.n"
alias echodebughej "echo $_.t.time.u1/$_.t.time.d1 late:$_.t.late,early:$_.t.early"
alias _.t.time.up "if (%1 == 0) then set _.t.time.u1 0 else if ($hud_gameclock_countdown == 0) then set _.t.time.u1 %1 else set_calc _.t.time.u1 60 - %1; if ('$_.t.n' isin 'rl') then _.t.time.up2"
alias _.t.time.up2 "set_calc _.t.time.u1 $_.t.time.u1 % 30; set_calc _.t.time.u2 $_.t.time.u1 + 30; echo u1:$_.t.time.u1 u2:$_.t.time.u2"
alias _.t.time.down "if (%1 == 0) then set _.t.time.d1 0 else if ($hud_gameclock_countdown > 0) then set _.t.time.d1 %1 else set_calc _.t.time.d1 60 - %1; if ('$_.t.n' isin 'rl') then _.t.time.down2"
alias _.t.time.down2 "set_calc _.t.time.d2 $_.t.time.d1 % 30; set_calc _.t.time.d1 $_.t.time.d2 + 30; echo c1:$_.t.time.d1 c2:$_.t.time.d2"
alias _.t.time.elate "set_calc _.t.late $_.t.time.u1 % $_.t.%1.time; set_calc _.t.early $_.t.time.d1 % $_.t.%1.time; if ($_.t.late == 0 AND $_.t.early == 0) then set _.t.elate 0 else if ($_.t.late <= $_.t.early) then set _.t.elate $_.t.late else set _.t.elate $_.t.early; _.t.time.elate.str"
alias _.t.time.elate.str "set_tp _.str.earlate $qt$qt; if ($_.t.late == 0 AND $_.t.early == 0) then set_tp _.str.earlate $tp_name_ontime else if ($_.t.late <= $_.t.early) then set_tp _.str.earlate $tp_name_late else set_tp _.str.earlate $tp_name_early; _.t.time.elate.str2"
alias _.t.time.elate.str2 "set_tp _.str.early $qt$qt; "
alias _.t.echo "wait; set tmpecho $qt$qt; _.t.itos $_.t.%1 tmpecho; echo $tp_name_%1: $tmpecho &caaa($_.t.elate $_.str.earlate)"
alias _.t.say "if ('$_.t.kp2' == '?') then _.t.kp.enter; if ('%1' == 'rl') then _.t.say.wep else if ('%1' == 'quad') then _.t.say.quad"
alias _.t.say.wep ".tsay.timer.wep $_.t.n"
alias _.t.say.quad ".tsay.timer.quad"

alias .tsay.timer.wep "say_team $\  $tp_name_%1 {&cfffis&r} $_.t.elate {&cfff$_.str.earlate&r} {&c9f9:$_.t.time.u1/$_.t.time.u2&r} {&cfffor&r} {&cf99:$_.t.time.d1/$_.t.time.d2&r}"
alias .tsay.timer.quad "say_team $\ $tp_name_quad {&cfffis on&r} {&c9f9:$_.t.time.u1&r} {&cfffor&r} {&cf99:$_.t.time.d1&r}"

// Keypad controls
////////////////////////////////////////////////////////////////////////////////////////////////////
set _.t.kp1 0
set _.t.kp2 0
alias _.t.kp.set "set_calc tmp2 %1 % 10; set_calc tmp1 %1 - $tmp2; set_calc tmp1 $tmp1 / 10; _.t.kp.setb $tmp1 $tmp2"
alias _.t.kp.setb "set _.t.kp1 %1; set _.t.kp2 %2; if ('%2' == '?') then _.t.kp.echo $_.t.n; if ('%2' == '?') then _.t.kp.bind2 else _.t.kp.enter"
alias _.t.kp.bind1 "bind kp_0 _.t.kp.setb 0 ?; bind kp_1 _.t.kp.setb 1 ?; bind kp_2 _.t.kp.setb 2 ?; bind kp_3 _.t.kp.setb 3 ?; bind kp_4 _.t.kp.setb 4 ?; bind kp_5 _.t.kp.setb 5 ?; bind kp_6 _.t.kp.setb 0 6; bind kp_7 _.t.kp.setb 0 7; bind kp_8 _.t.kp.setb 0 8; bind kp_9 _.t.kp.setb 0 9"
alias _.t.kp.bind2 "bind kp_0 _.t.kp.setb $_.t.kp1 0; bind kp_1 _.t.kp.setb $_.t.kp1 1; bind kp_2 _.t.kp.setb $_.t.kp1 2; bind kp_3 _.t.kp.setb $_.t.kp1 3; bind kp_4 _.t.kp.setb $_.t.kp1 4; bind kp_5 _.t.kp.setb $_.t.kp1 5; bind kp_6 _.t.kp.setb $_.t.kp1 6; bind kp_7 _.t.kp.setb $_.t.kp1 7; bind kp_8 _.t.kp.setb $_.t.kp1 8; bind kp_9 _.t.kp.setb $_.t.kp1 9"
alias _.t.kp.late "_.t.kp.final; set_calc tmp $_.t.kp1 * 10; set_calc tmp $tmp + $_.t.kp2; if ($hud_gameclock_countdown > 0) then set_calc tmp 60 - $tmp; _.t.kp.set $tmp"
alias _.t.kp.early "_.t.kp.final; set_calc tmp $_.t.kp1 * 10; set_calc tmp $tmp + $_.t.kp2; if ($hud_gameclock_countdown == 0) then set_calc tmp 60 - $tmp; _.t.kp.set $tmp"
alias _.t.kp.final "_.t.kp.fixqm; _.t.kp.bind1"
alias _.t.kp.enter "_.t.kp.final; _.t.set.from.kp;"
alias _.t.kp.fixqm "if ('$_.t.kp2' == '?') then set tmp1 0 else set tmp1 $_.t.kp1; if ('$_.t.kp2' == '?') then set _.t.kp2 $_.t.kp1; set _.t.kp1 $tmp1"
alias _.t.kp.echo "echo $tp_name_%1: $_.t.kp1$_.t.kp2"

bind kp_enter "_.t.kp.enter"
bind kp_minus "_.t.kp.late"
bind kp_plus "_.t.kp.early"

bind mwheelup "_.t.up $_.t.n"
bind mwheeldown "_.t.down $_.t.n"
bind mouse4 "_.t.activate rl"
bind mouse5 "_.t.activate quad"
bind f "_.t.say $_.t.n"

_.t.reset rl
_.t.reset quad
_.t.kp.bind1
